# Data and DML

Data Manipulation Statements
  - used for accessing and manipulating data in a database
  - Four types:
    1. `INSERT` statements
      - add new data into a database table
    2. `SELECT` statements or Queries
      - retrieve existing data from database tables
    3. `UPDATE` statements
      - update existing data in database table
    4. `DELETE` statements
      - delete existing data from database table

**Actions performed by these 4 types of statements may be referred to as CRUD operations**

#
#

## `CRUD`
  - Create
  - Read
  - Update
  - Delete

  *analogous to insert, select, update, delete statements*

Web apps whose main purpose is to provide an interface to perform these operations are 'CRUD' apps.

#
#
#


## Insertion Statement Syntax

Must provide 3 pieces of information when using `INSERT` statement:
  - table name we wish to store data in
  - names of columns we are adding data to
  - values we wish to store in the columns listed after table name


```sql
INSERT INTO table_name
  (column1_name, column2_name,...)
  VALUES (data_for_column1, data_for_column2, ...);
```


#
#

## Adding rows of Data

Columns give structure to our table, rows actually contain the data.

Each row in the table is an individual entity
  - a record with a corresponding value for each column in the table


### Adding a single row

Now we want to add a record, or row, into the `users` table with the following values:

  - `id`: We'll use the default value for this; an integer generated by the `nextval` function
  - `full_name`: 'John Smith'
  - `enabled`: false
  - `last_login`: We'll use the default value for this; The current time and date.

```sql
INSERT INTO users (full_name, enabled)
           VALUES ('John Smith', false);
```


#
#

## Adding Multiple Rows

```sql
INSERT INTO users (full_name)
  VALUES ('Jane Smith'), ('Harry Potter');
```

#
#
#

## Constraints and Adding Data

Constraints are set at the level of schema, so part of DDL but primarily concerned with controlling what data can be added ot table. 


### Default Values

Used if value is not specified for column in `INSERT` statement.

### NOT NULL Constraints

Columns do not always need default values

Use NOT NULL constraint to require a value. Will throw error if none provided. 

### Unique constraints

Does not allow duplicate values to be added in column

### CHECK constraints

Ensure values entered into column conform to particular rules. 
  - limit data type that can be included based on condition we set in the constraint.

```sql
ALTER TABLE users ADD CHECK (full_name <> '')
```

```sql
INSERT INTO users (id, full_name) VALUES (4, '');
```

#
#


## Exercises

1. Make sure you are connected to the encyclopedia database. Add the following data to the countries table:

```
Name 	Capital 	Population
France 	Paris 	67,158,000
```

```sql
INSERT INTO countries (name, capital, population)
             VALUES ('France', 'Paris', 67158000);
```


2. Now add the following additional data to the countries table:

```
Name 	Capital 	Population
USA 	Washington D.C. 	325,365,189
Germany 	Berlin 	82,349,400
Japan 	Tokyo 	126,672,000
```

```sql
INSERT INTO countries (name, capital, population)
             VALUES ('USA', 'Washington D.C.', 325365189),
                    ('Germany', 'Berlin', 82349400),
                    ('Japan', 'Tokyo', 126672000);
```


3. Add an entry to the celebrities table for the singer and songwriter Bruce Springsteen, who was born on September 23rd 1949 and is still alive.

```sql
INSERT INTO celebrities (first_name, last_name, occupation, date_of_birth, deceased)
              VALUES ('Bruce', 'Springsteen', 'Singer, Songwriter', '1949-09-23', false);
```

4. Add an entry for the actress Scarlett Johansson, who was born on November 22nd 1984. Use the default value for the deceased column.


```sql
INSERT INTO celebrities (first_name, last_name, occupation, date_of_birth)
                 VALUES ('Scarlett', 'Johansson', 'Actress', '1984-11-22');
```

5. Add the following two entries to the celebrities table with a single INSERT statement. For Frank Sinatra set true as the value for the deceased column. For Tom Cruise, don't set an explicit value for the deceased column, but use the default value.

```
First Name 	Last Name 	Occupation 	D.O.B.
Frank 	Sinatra 	Singer, Actor 	December 12, 1915
Tom 	Cruise 	Actor 	July 03, 1962
```

```sql
INSERT INTO celebrities (first_name, last_name, occupation, date_of_birth, deceased)
                VALUES ('Frank', 'Sinatra', 'Singer, Actor', '1915-12-12', true),
                       ('Tom', 'Cruise', 'Actor', '1962-07-03', DEFAULT);
```

6. Look at the schema of the celebrities table. What do you think will happen if we try to insert the following data?
```
First Name 	Last Name 	Occupation 	D.O.B. 	Deceased
Madonna 		Singer, Actress 	'08/16/1958' 	false
Prince 		Singer, Songwriter, Musician, Actor 	'06/07/1958' 	true
```

We would get an error because of the column constraint NOT NULL set for the last_name column. 


7. Update the last_name column of the celebrities table so that the data in the previous question can be entered, and then add the data to the table.

```sql
ALTER TABLE celebrities
  ALTER COLUMN last_name DROP NOT NULL;
```

```sql
INSERT INTO celebrities (first_name, occupation, date_of_birth, deceased)
                 VALUES ('Madonna', 'Singer, Actress', '1958-08-16', false),
                        ('Prince', 'Singer, Songwriter, Musician, Actor', '1958-06-07', true);
```



8. Check the schema of the celebrities table. What would happen if we specify a NULL value for deceased column, such as with the data below?
```
First Name 	Last Name 	Occupation 	D.O.B. 	Deceased
Elvis 	Presley 	Singer, Musician, Actor 	'01/08/1935' 	NULL
```

It would be set to NULL and override the default. Best to avoid this by setting constraint to not allow NULL in boolean data types. 


9. Check the schema of the animals table. What would happen if we tried to insert the following data to the table?

```
Name 	Binomial Name 	Max Weight (kg) 	Max Age (years) 	Conservation Status
Dove 	Columbidae Columbiformes 	2 	15 	LC
Golden Eagle 	Aquila Chrysaetos 	6.35 	24 	LC
Peregrine Falcon 	Falco Peregrinus 	1.5 	15 	LC
Pigeon 	Columbidae Columbiformes 	2 	15 	LC
Kakapo 	Strigops habroptila 	4 	60 	CR
```

Identify the problem and alter the table so that the data can be entered as shown, and then insert the data.


```sql
ALTER TABLE animals
  DROP CONSTRAINT unique_binomial_name;
```



10. Connect to the ls_burger database and examine the schema for the orders table.

Based on the table schema and following information, write and execute an INSERT statement to add the appropriate data to the orders table.

There are three customers -- James Bergman, Natasha O'Shea, Aaron Muller. James' email address is james1998@email.com. Natasha's email address is natasha@osheafamily.com. Aaron doesn't supply an email address.

James orders a LS Chicken Burger, Fries and a Cola. Natasha has two orders -- an LS Cheeseburger with Fries but no drink, and an LS Double Deluxe Burger with Onion Rings and a Chocolate Shake. Aaron orders an LS Burger with no side or drink.

The item costs and loyalty points are listed below:

```
Item 	Cost ($) 	Loyalty Points
LS Burger 	3.00 	10
LS Cheeseburger 	3.50 	15
LS Chicken Burger 	4.50 	20
LS Double Deluxe Burger 	6.00 	30
Fries 	0.99 	3
Onion Rings 	1.50 	5
Cola 	1.50 	5
Lemonade 	1.50 	5
Vanilla Shake 	2.00 	7
Chocolate Shake 	2.00 	7
Strawberry Shake 	2.00 	7
```

```sql
INSERT INTO orders (customer_name, customer_email, customer_loyalty_points, burger, side, drink, burger_cost, side_cost, drink_cost)
            VALUES ('James Bergman', 'james1998@email.com', 28, 'LS Chicken Burger', 'Fries', 'Cola', 4.50, 0.99, 1.50),
                   ('Natasha O''Shea', 'natasha@osheafamily.com', 18, 'LS Cheeseburger', 'Fries', NULL, 3.50, 0.99, DEFAULT),
                   ('Natasha O''Shea', 'natasha@osheafamily.com', 42, 'LS Double Deluxe Burger', 'Onion Rings', 'Chocolate Shake', 6.00, 1.50, 2.00),
                   ('Aaron Muller', NULL, 10, 'LS Burger', NULL, NULL, 3.00, DEFAULT, DEFAULT);
```